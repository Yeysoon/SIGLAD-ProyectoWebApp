<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crear DUCA - SIGLAD</title>
    <link rel="icon" href="/favicon.ico" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link href="./css/usuarios.css" rel="stylesheet" />
    <style>
      .form-section {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        padding: 25px;
        margin-bottom: 20px;
      }

      .section-title {
        font-size: 18px;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .form-label {
        font-weight: 600;
        color: #34495e;
        font-size: 14px;
        margin-bottom: 8px;
      }

      .form-control,
      .form-select {
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 10px 15px;
        transition: all 0.3s ease;
        font-size: 14px;
      }

      .form-control:focus,
      .form-select:focus {
        border-color: #3498db;
        box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.15);
      }

      .btn-icon {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        font-weight: 600;
      }

      .alert-custom {
        border-left: 4px solid #3498db;
        border-radius: 8px;
        background: #e8f4fd;
        color: #2c3e50;
        padding: 15px 20px;
      }

      .subsection {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-top: 15px;
        border-left: 3px solid #3498db;
      }

      .subsection-title {
        font-size: 16px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 15px;
      }

      .response-box {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        font-family: 'Courier New', monospace;
        font-size: 13px;
        max-height: 400px;
        overflow-y: auto;
        border: 2px solid #e0e0e0;
      }

      .sticky-buttons {
        position: sticky;
        bottom: 20px;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        z-index: 100;
      }

      .tab-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .tab-btn {
        flex: 1;
        padding: 12px;
        border: 2px solid #e0e0e0;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        color: #2c3e50;
      }

      .tab-btn:hover {
        border-color: #3498db;
      }

      .tab-btn.active {
        border-color: #3498db;
        background: #3498db;
        color: white;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">SIGLAD</div>
        <div class="sidebar-subtitle">Gestión Logística</div>
      </div>
      <ul class="sidebar-menu">
        <li>
          <a href="dashboardDuca.html">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li>
          <a href="duca.html" class="active">
            <i class="fa-solid fa-folder-plus"></i>
            <span>Crear DUCA</span>
          </a>
        </li>
        <li>
          <a href="statusDuca.html">
            <i class="fa-solid fa-bars-progress"></i>
            <span>Estado de DUCAs</span>
          </a>
        </li>
        <li><hr /></li>
        <li>
          <a href="#" id="btnLogout">
            <i class="fas fa-sign-out-alt"></i>
            <span>Cerrar Sesión</span>
          </a>
        </li>
      </ul>
    </aside>

    <!-- HEADER -->
    <header class="header">
      <div class="header-title">Nueva DUCA</div>
      <div class="header-actions">
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">T</div>
          <div>
            <span id="roleInfo">Usuario Transportista</span>
          </div>
        </div>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main-content">
      <div class="alert alert-custom" role="alert">
        <i class="fas fa-info-circle" style="margin-right: 8px"></i>
        <strong>Instrucciones:</strong> Puedes usar el formulario guiado o pegar
        directamente el JSON del Anexo II. Solo usuarios con rol
        <code>TRANSPORTISTA</code> pueden enviar documentos.
      </div>

      <!-- Tabs -->
      <div class="form-section">
        <div class="tab-buttons">
          <button class="tab-btn" id="tabJsonBtn">
            <i class="fas fa-code"></i> Modo JSON
          </button>
          <button class="tab-btn active" id="tabFormBtn">
            <i class="fa-solid fa-clipboard-list"></i> Modo Formulario
          </button>
        </div>

        <!-- MODO JSON -->
        <div id="jsonTab" class="tab-content">
          <div class="row g-4">
            <div class="col-lg-7">
              <div class="d-flex justify-content-end gap-2 mb-3">
                <button
                  id="btnPreload"
                  class="btn btn-sm btn-outline-primary btn-icon"
                >
                  <i class="fas fa-file-import"></i>
                  Cargar ejemplo
                </button>
                <button
                  id="btnPretty"
                  class="btn btn-sm btn-outline-secondary btn-icon"
                >
                  <i class="fas fa-align-left"></i>
                  Formatear
                </button>
              </div>

              <textarea
                id="jsonInput"
                class="form-control"
                style="font-family: 'Courier New', monospace; font-size: 13px"
                rows="20"
                placeholder='{"duca": { "numeroDocumento": "...", ... }}'
              ></textarea>

              <div id="valErrors" class="mt-3"></div>

              <div class="d-flex gap-2 mt-3 align-items-center">
                <button
                  id="btnValidate"
                  class="btn btn-outline-secondary btn-icon"
                >
                  <i class="fas fa-check-circle"></i>
                  Validar JSON
                </button>
                <button id="btnSend" class="btn btn-primary btn-icon">
                  <i class="fas fa-paper-plane"></i>
                  Enviar DUCA
                </button>
                <div id="status" class="ms-2"></div>
              </div>
            </div>

            <div class="col-lg-5">
              <h5 style="margin-bottom: 15px; font-weight: 700; color: #2c3e50">
                <i class="fas fa-server"></i> Respuesta del Servidor
              </h5>
              <div class="response-box">
                <pre id="serverOut" style="margin: 0; color: #2c3e50">{}</pre>
              </div>
            </div>
          </div>
        </div>

        <!-- MODO FORMULARIO -->
        <div id="formTab" class="tab-content active">
          <form id="ducaForm">
            <div class="row">
              <!-- COLUMNA PRINCIPAL -->
              <div class="col-lg-8">
                <!-- INFORMACIÓN GENERAL -->
                <div class="mb-4">
                  <h3 class="section-title">
                    <i class="fas fa-file-alt"></i>
                    Información General del Documento
                  </h3>

                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label"
                        >Número de Documento
                        <span style="color: #e74c3c">*</span></label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="numeroDocumento"
                        placeholder="GT2025DUCA001234"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label"
                        >Fecha de Emisión
                        <span style="color: #e74c3c">*</span></label
                      >
                      <input
                        type="date"
                        class="form-control"
                        id="fechaEmision"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label"
                        >País Emisor
                        <span style="color: #e74c3c">*</span></label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="paisEmisor"
                        placeholder="GT"
                        value="GT"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label"
                        >Tipo de Operación
                        <span style="color: #e74c3c">*</span></label
                      >
                      <select class="form-select" id="tipoOperacion" required>
                        <option value="">Seleccione...</option>
                        <option value="IMPORTACION">Importación</option>
                        <option value="EXPORTACION">Exportación</option>
                        <option value="TRANSITO">Tránsito</option>
                      </select>
                    </div>
                  </div>
                </div>

                <!-- EXPORTADOR -->
                <div class="mb-4">
                  <h3 class="section-title">
                    <i class="fas fa-truck-loading"></i>
                    Datos del Exportador
                  </h3>

                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label"
                        >ID Exportador
                        <span style="color: #e74c3c">*</span></label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="idExportador"
                        placeholder="EXP-00145"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label"
                        >Nombre/Razón Social
                        <span style="color: #e74c3c">*</span></label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="nombreExportador"
                        placeholder="Comercial del Norte S.A."
                        required
                      />
                    </div>
                    <div class="col-12">
                      <label class="form-label"
                        >Dirección <span style="color: #e74c3c">*</span></label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="direccionExportador"
                        placeholder="Zona 12, Ciudad de Guatemala"
                        required
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Teléfono</label>
                      <input
                        type="tel"
                        class="form-control"
                        id="telefonoExportador"
                        placeholder="+50212345678"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Email</label>
                      <input
                        type="email"
                        class="form-control"
                        id="emailExportador"
                        placeholder="exportaciones@empresa.gt"
                      />
                    </div>
                  </div>
                </div>

                <!-- IMPORTADOR -->
                <div class="mb-4">
                  <h3 class="section-title">
                    <i class="fas fa-warehouse"></i>
                    Datos del Importador
                  </h3>

                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label"
                        >ID Importador
                        <span style="color: #e74c3c">*</span></label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="idImportador"
                        placeholder="IMP-00984"
                        required
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label"
                        >Nombre/Razón Social
                        <span style="color: #e74c3c">*</span></label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="nombreImportador"
                        placeholder="Distribuciones del Sur Ltda."
                        required
                      />
                    </div>
                    <div class="col-12">
                      <label class="form-label"
                        >Dirección <span style="color: #e74c3c">*</span></label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="direccionImportador"
                        placeholder="San Salvador, El Salvador"
                        required
                      />
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">Teléfono</label>
                      <input
                        type="tel"
                        class="form-control"
                        id="telefonoImportador"
                        placeholder="+50312345678"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Email</label>
                      <input
                        type="email"
                        class="form-control"
                        id="emailImportador"
                        placeholder="importaciones@empresa.sv"
                      />
                    </div>
                  </div>
                </div>

                <!-- TRANSPORTE -->
                <div class="mb-4">
                  <h3 class="section-title">
                    <i class="fas fa-truck"></i>
                    Información de Transporte
                  </h3>

                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">Medio de Transporte</label>
                      <select class="form-select" id="medioTransporte">
                        <option value="">Seleccione...</option>
                        <option value="TERRESTRE">Terrestre</option>
                        <option value="MARITIMO">Marítimo</option>
                        <option value="AEREO">Aéreo</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Placa Vehículo</label>
                      <input
                        type="text"
                        class="form-control"
                        id="placaVehiculo"
                        placeholder="C123BGT"
                      />
                    </div>

                    <div class="subsection">
                      <div class="subsection-title">Datos del Conductor</div>
                      <div class="row g-3">
                        <div class="col-md-6">
                          <label class="form-label">Nombre del Conductor</label>
                          <input
                            type="text"
                            class="form-control"
                            id="nombreConductor"
                            placeholder="Juan Pérez"
                          />
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Licencia</label>
                          <input
                            type="text"
                            class="form-control"
                            id="licenciaConductor"
                            placeholder="L-987654"
                          />
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">País de Licencia</label>
                          <input
                            type="text"
                            class="form-control"
                            id="paisLicencia"
                            placeholder="GT"
                            value="GT"
                          />
                        </div>
                      </div>
                    </div>

                    <div class="subsection">
                      <div class="subsection-title">Ruta</div>
                      <div class="row g-3">
                        <div class="col-md-6">
                          <label class="form-label">Aduana de Salida</label>
                          <input
                            type="text"
                            class="form-control"
                            id="aduanaSalida"
                            placeholder="PUERTO BARRIOS"
                          />
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Aduana de Entrada</label>
                          <input
                            type="text"
                            class="form-control"
                            id="aduanaEntrada"
                            placeholder="SAN CRISTÓBAL"
                          />
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">País Destino</label>
                          <input
                            type="text"
                            class="form-control"
                            id="paisDestino"
                            placeholder="SV"
                          />
                        </div>
                        <div class="col-md-6">
                          <label class="form-label"
                            >Kilómetros Aproximados</label
                          >
                          <input
                            type="number"
                            class="form-control"
                            id="kilometrosAproximados"
                            placeholder="325"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- MERCANCÍAS -->
                <div class="mb-4">
                  <h3 class="section-title">
                    <i class="fas fa-boxes"></i>
                    Información de Mercancías
                  </h3>

                  <div id="mercanciasContainer">
                    <div class="mercancia-item subsection mb-3" data-index="0">
                      <div
                        class="d-flex justify-content-between align-items-center mb-3"
                      >
                        <div class="subsection-title">Mercancía #1</div>
                        <button
                          type="button"
                          class="btn btn-sm btn-outline-danger remove-mercancia"
                          style="display: none"
                        >
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>

                      <div class="row g-3">
                        <div class="col-md-12">
                          <label class="form-label">Descripción</label>
                          <input
                            type="text"
                            class="form-control mercancia-desc"
                            placeholder="Componentes electrónicos"
                          />
                        </div>
                        <div class="col-md-4">
                          <label class="form-label">Cantidad</label>
                          <input
                            type="number"
                            class="form-control mercancia-cantidad"
                            placeholder="500"
                          />
                        </div>
                        <div class="col-md-4">
                          <label class="form-label">Unidad de Medida</label>
                          <input
                            type="text"
                            class="form-control mercancia-unidad"
                            placeholder="CAJA"
                          />
                        </div>
                        <div class="col-md-4">
                          <label class="form-label">Valor Unitario (USD)</label>
                          <input
                            type="number"
                            step="0.01"
                            class="form-control mercancia-valor"
                            placeholder="45.50"
                          />
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">País de Origen</label>
                          <input
                            type="text"
                            class="form-control mercancia-origen"
                            placeholder="CN"
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  <button
                    type="button"
                    class="btn btn-outline-primary btn-icon"
                    id="addMercancia"
                  >
                    <i class="fas fa-plus-circle"></i>
                    Agregar otra mercancía
                  </button>
                </div>

                <!-- VALORES -->
                <div class="mb-4">
                  <h3 class="section-title">
                    <i class="fas fa-dollar-sign"></i>
                    Valores Económicos
                  </h3>

                  <div class="row g-3">
                    <div class="col-md-6">
                      <label class="form-label">Valor de Factura (USD)</label>
                      <input
                        type="number"
                        step="0.01"
                        class="form-control"
                        id="valorFactura"
                        placeholder="32500.00"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label"
                        >Gastos de Transporte (USD)</label
                      >
                      <input
                        type="number"
                        step="0.01"
                        class="form-control"
                        id="gastosTransporte"
                        placeholder="1500.00"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Seguro (USD)</label>
                      <input
                        type="number"
                        step="0.01"
                        class="form-control"
                        id="seguro"
                        placeholder="300.00"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Otros Gastos (USD)</label>
                      <input
                        type="number"
                        step="0.01"
                        class="form-control"
                        id="otrosGastos"
                        placeholder="100.00"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Valor Aduana Total (USD)</label>
                      <input
                        type="number"
                        step="0.01"
                        class="form-control"
                        id="valorAduanaTotal"
                        placeholder="34400.00"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Moneda</label>
                      <input
                        type="text"
                        class="form-control"
                        id="moneda"
                        placeholder="USD"
                        value="USD"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- COLUMNA LATERAL -->
              <div class="col-lg-4">
                <!-- VISTA PREVIA JSON -->
                <div class="form-section" style="position: sticky; top: 20px">
                  <h5
                    style="
                      margin-bottom: 15px;
                      font-weight: 700;
                      color: #2c3e50;
                    "
                  >
                    <i class="fas fa-code"></i> Vista Previa JSON
                  </h5>
                  <div class="response-box">
                    <pre
                      id="jsonPreview"
                      style="margin: 0; color: #2c3e50; font-size: 11px"
                    >
{}</pre
                    >
                  </div>

                  <div class="d-grid gap-2 mt-3">
                    <button
                      type="button"
                      class="btn btn-outline-secondary btn-icon btn-sm"
                      id="btnGenerateJSON"
                    >
                      <i class="fas fa-sync-alt"></i>
                      Actualizar Vista Previa
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- BOTONES DE ACCIÓN -->
            <div class="sticky-buttons">
              <div class="d-flex gap-3 justify-content-end">
                <button
                  type="button"
                  class="btn btn-outline-secondary btn-icon"
                  id="btnResetForm"
                >
                  <i class="fas fa-redo"></i>
                  Limpiar Formulario
                </button>
                <button
                  type="button"
                  class="btn btn-outline-primary btn-icon"
                  id="btnValidateForm"
                >
                  <i class="fas fa-check-circle"></i>
                  Validar
                </button>
                <button type="submit" class="btn btn-primary btn-icon">
                  <i class="fas fa-paper-plane"></i>
                  Enviar DUCA
                </button>
              </div>
              <div id="statusForm" class="text-center mt-2"></div>
              <div id="valErrorsForm" class="mt-2"></div>
            </div>
          </form>
        </div>
      </div>

      <!-- Respuesta del servidor para formulario -->
      <div id="serverResponseForm" class="form-section" style="display: none">
        <h3 class="section-title">
          <i class="fas fa-server"></i>
          Respuesta del Servidor
        </h3>
        <div class="response-box">
          <pre id="serverOutForm" style="margin: 0; color: #2c3e50">{}</pre>
        </div>
      </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./vendor/sweetalert2.all.min.js"></script>
    <script src="/js/duca.js"></script>
  </body>
</html>
